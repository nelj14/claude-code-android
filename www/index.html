<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Claude Code Terminal</title>
    <meta name="description" content="Claude Code Terminal Interface">
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="manifest.json">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a1a;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }
        #terminal {
            width: 100vw;
            height: 100vh;
            padding: 10px;
            box-sizing: border-box;
            background: #000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .input-line {
            display: flex;
            align-items: center;
        }
        .prompt {
            color: #00ff00;
            margin-right: 5px;
        }
        #command-input {
            background: transparent;
            border: none;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            outline: none;
            flex: 1;
        }
        .output {
            margin: 5px 0;
            color: #ffffff;
        }
        .error {
            color: #ff6b6b;
        }
    </style>
</head>
<body>
    <div id="terminal">
        <div class="output">Claude Code Terminal</div>
        <div class="output">Type 'help' for available commands</div>
        <div class="input-line">
            <span class="prompt">$</span>
            <input type="text" id="command-input" autofocus>
        </div>
    </div>

    <script>
        const terminal = document.getElementById('terminal');
        const commandInput = document.getElementById('command-input');
        let isClaudeRunning = false;

        function addOutput(text, className = 'output') {
            const outputDiv = document.createElement('div');
            outputDiv.className = className;
            outputDiv.textContent = text;
            
            // Insert before the input line
            const inputLine = document.querySelector('.input-line');
            terminal.insertBefore(outputDiv, inputLine);
            terminal.scrollTop = terminal.scrollHeight;
        }

        function addPrompt() {
            const inputLine = document.createElement('div');
            inputLine.className = 'input-line';
            inputLine.innerHTML = '<span class="prompt">$</span><input type="text" class="command-input" autofocus>';
            terminal.appendChild(inputLine);
            
            const newInput = inputLine.querySelector('.command-input');
            newInput.addEventListener('keypress', handleCommand);
            newInput.focus();
            terminal.scrollTop = terminal.scrollHeight;
        }

        function startClaude() {
            if (isClaudeRunning) {
                addOutput('Claude Code is already running', 'error');
                return;
            }
            
            isClaudeRunning = true;
            addOutput('ðŸš€ Initializing Claude Code Web Terminal...');
            addOutput('');
            addOutput('âœ… Claude AI Assistant Ready!');
            addOutput('ðŸ’¬ I can help with coding, writing, analysis, and more');
            addOutput('ðŸ“± Optimized for mobile and desktop browsers');
            addOutput('');
            addOutput('Available commands:');
            addOutput('  help     - Show available commands');  
            addOutput('  clear    - Clear terminal');
            addOutput('  claude   - Restart Claude interface');
            addOutput('  version  - Show version info');
            addOutput('  exit     - Close application');
            addOutput('');
        }

        function handleCommand(event) {
            if (event.key === 'Enter') {
                const command = event.target.value.trim();
                event.target.disabled = true;
                
                // Show the command that was entered
                const commandDiv = document.createElement('div');
                commandDiv.className = 'output';
                commandDiv.innerHTML = '<span class="prompt">$ </span>' + command;
                terminal.insertBefore(commandDiv, document.querySelector('.input-line'));
                
                // Process the command
                processCommand(command);
                
                // Clear and re-enable input
                event.target.value = '';
                event.target.disabled = false;
                event.target.focus();
            }
        }

        function processCommand(command) {
            const args = command.split(' ');
            const cmd = args[0].toLowerCase();

            switch(cmd) {
                case 'claude':
                    startClaude();
                    break;
                case 'help':
                    addOutput('ðŸ“‹ Available commands:');
                    addOutput('  claude      - Start/restart Claude Code interface');
                    addOutput('  help        - Show this help menu');
                    addOutput('  clear       - Clear terminal screen');
                    addOutput('  version     - Show version information');
                    addOutput('  about       - About this terminal');
                    addOutput('  status      - Show system status');
                    addOutput('  token       - Set up API authentication token');
                    addOutput('  cleartoken  - Remove saved API token');
                    addOutput('  exit        - Exit application');
                    addOutput('');
                    addOutput('ðŸ’¬ After setting up your token, just type questions to interact with real Claude AI!');
                    break;
                case 'version':
                    addOutput('Claude Code Web Terminal v1.0');
                    addOutput('Built with HTML5, CSS3, JavaScript');
                    addOutput('Compatible with all modern browsers');
                    break;
                case 'about':
                    addOutput('ðŸ¤– Claude Code Web Terminal');
                    addOutput('A web-based interface for Claude AI assistance');
                    addOutput('Created for mobile and desktop browsers');
                    addOutput('');
                    addOutput('Features:');
                    addOutput('â€¢ Terminal-style interface');
                    addOutput('â€¢ Mobile-optimized design');
                    addOutput('â€¢ Real-time command processing');
                    break;
                case 'status':
                    addOutput('ðŸ“Š System Status:');
                    addOutput('â€¢ Claude Status: ' + (isClaudeRunning ? 'ðŸŸ¢ Running' : 'ðŸ”´ Stopped'));
                    addOutput('â€¢ API Token: ' + (localStorage.getItem('claude_auth_token') ? 'ðŸŸ¢ Configured' : 'ðŸ”´ Not set'));
                    addOutput('â€¢ Browser: ' + navigator.userAgent.split('(')[0]);
                    addOutput('â€¢ Platform: ' + navigator.platform);
                    addOutput('â€¢ Screen: ' + screen.width + 'x' + screen.height);
                    break;
                case 'token':
                    const newToken = prompt('Enter your Claude API token:');
                    if (newToken) {
                        localStorage.setItem('claude_auth_token', newToken);
                        addOutput('âœ… API token updated successfully');
                    } else {
                        addOutput('âŒ Token setup cancelled');
                    }
                    break;
                case 'cleartoken':
                    localStorage.removeItem('claude_auth_token');
                    addOutput('ðŸ—‘ï¸ API token cleared');
                    break;
                case 'clear':
                    // Remove all output except the current input line
                    const outputs = terminal.querySelectorAll('.output');
                    outputs.forEach(output => output.remove());
                    break;
                case 'exit':
                    addOutput('Goodbye!');
                    setTimeout(() => {
                        if (window.Capacitor) {
                            window.Capacitor.Plugins.App.exitApp();
                        }
                    }, 1000);
                    break;
                case '':
                    // Empty command, just add a new prompt
                    break;
                default:
                    if (isClaudeRunning) {
                        addOutput('ðŸ¤– Processing: ' + command);
                        simulateClaudeResponse(command);
                    } else {
                        addOutput('Command not found: ' + cmd, 'error');
                        addOutput('Type "claude" to start, or "help" for available commands');
                    }
            }
        }

        async function simulateClaudeResponse(command) {
            // Add typing indicator
            const typingDiv = document.createElement('div');
            typingDiv.className = 'output';
            typingDiv.innerHTML = 'ðŸ’­ Claude is thinking...';
            const inputLine = document.querySelector('.input-line');
            terminal.insertBefore(typingDiv, inputLine);
            terminal.scrollTop = terminal.scrollHeight;

            try {
                // Call real Claude API
                const response = await callClaudeAPI(command);
                typingDiv.remove();
                addOutput('ðŸ¤– Claude: ' + response);
            } catch (error) {
                typingDiv.remove();
                addOutput('âŒ Error: ' + error.message, 'error');
                addOutput('ðŸ’¡ Using fallback response...', 'error');
                
                // Fallback to simulation if API fails
                let fallbackResponse = generateResponse(command);
                addOutput('ðŸ¤– Claude (offline): ' + fallbackResponse);
            }
        }

        async function callClaudeAPI(message) {
            const API_URL = 'https://api.rdsec.trendmicro.com/prod/aiendpoint/v1/messages';
            const API_TOKEN = await getAuthToken();
            
            if (!API_TOKEN) {
                throw new Error('No authentication token available. Please set up your API credentials.');
            }

            const response = await fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_TOKEN}`,
                    'anthropic-version': '2023-06-01'
                },
                body: JSON.stringify({
                    model: 'claude-4-sonnet',
                    max_tokens: 1000,
                    messages: [{
                        role: 'user',
                        content: message
                    }]
                })
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`API request failed: ${response.status} - ${errorText}`);
            }

            const data = await response.json();
            return data.content[0].text;
        }

        async function getAuthToken() {
            // For security, we'll prompt user to enter their token
            // In a real app, this would be stored securely
            let token = localStorage.getItem('claude_auth_token');
            
            if (!token) {
                token = prompt('Please enter your Claude API token:');
                if (token) {
                    localStorage.setItem('claude_auth_token', token);
                    addOutput('âœ… Token saved locally (for this browser session)');
                } else {
                    return null;
                }
            }
            
            return token;
        }

        function generateResponse(command) {
            const lowerCommand = command.toLowerCase();
            
            // Programming related
            if (lowerCommand.includes('code') || lowerCommand.includes('program') || lowerCommand.includes('function')) {
                return "I'd be happy to help with coding! What programming language or specific task are you working on?";
            }
            
            // Questions
            if (lowerCommand.includes('what') || lowerCommand.includes('how') || lowerCommand.includes('why')) {
                return "That's a great question! I can help explain concepts, provide step-by-step guidance, or dive into technical details.";
            }
            
            // Greetings
            if (lowerCommand.includes('hello') || lowerCommand.includes('hi') || lowerCommand.includes('hey')) {
                return "Hello! I'm Claude, your AI assistant. I can help with coding, writing, analysis, and answering questions. What would you like to work on?";
            }
            
            // Help requests
            if (lowerCommand.includes('help') || lowerCommand.includes('assist')) {
                return "I'm here to help! I can assist with:\nâ€¢ Programming and software development\nâ€¢ Writing and editing\nâ€¢ Data analysis and problem-solving\nâ€¢ Explanations and tutorials\nâ€¢ Code review and debugging";
            }
            
            // Android/mobile related
            if (lowerCommand.includes('android') || lowerCommand.includes('mobile') || lowerCommand.includes('app')) {
                return "I can help with Android development! Whether you need help with Java/Kotlin, app architecture, UI design, or debugging mobile apps.";
            }
            
            // Default responses
            const responses = [
                "I understand you're asking about '" + command + "'. Could you provide more details so I can give you a more specific answer?",
                "That's an interesting topic! What specific aspect would you like me to focus on?",
                "I can help with that. What's your main goal or what are you trying to accomplish?",
                "Let me help you with that. Can you share more context about what you're working on?",
                "I'd be happy to assist! What would you like to know more about?"
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // Initialize
        commandInput.addEventListener('keypress', handleCommand);
        
        // Register service worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Auto-start Claude Code
        setTimeout(() => {
            startClaude();
        }, 1000);
    </script>
</body>
</html>